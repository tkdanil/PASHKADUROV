# Telegram Bot для проверки содержимого файлов на виртуальных машинах

Этот Telegram бот позволяет подключаться к виртуальным машинам через SSH и проверять содержимое файлов в различных каталогах.

## Быстрый старт

### Для Windows:
```bash
# Способ 1: Автоматическая установка
python setup.py

# Способ 2: Через bat-файл
run.bat

# Способ 3: Ручная установка
py -m venv venv
.\venv\Scripts\Activate.ps1
pip install -r requirements.txt
py main.py
```

### Для Linux/Mac:
```bash
# Способ 1: Автоматическая установка
python3 setup.py

# Способ 2: Через sh-файл
chmod +x run.sh
./run.sh

# Способ 3: Ручная установка
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
python3 main.py
```

## Настройка в IDE

### PyCharm:
См. файл [PYCHARM_SETUP.md](PYCHARM_SETUP.md) для подробной инструкции.

### VS Code:
См. файл [VSCODE_SETUP.md](VSCODE_SETUP.md) для подробной инструкции.

## Подробная инструкция

См. файл [INSTALL.md](INSTALL.md) для подробной инструкции по установке и решения проблем.

## Функциональность

### Основные команды:

1. **`/start`** - Регистрация нового пользователя
   - Создает нового пользователя в системе
   - Предлагает выбрать роль (преподаватель/студент)

2. **`/status`** - Информация о пользователе
   - Показывает статус пользователя
   - Отображает информацию о настроенной виртуальной машине
   - Предлагает использовать `/vmpath` для настройки ВМ

3. **`/vmpath`** - Настройка подключения к виртуальной машине
   - Принимает данные в формате: `IP:пользователь:пароль`
   - Пример: `192.168.1.100:ubuntu:mypassword`
   - Сохраняет настройки подключения в базе данных

4. **`/check`** - Проверка подключения к виртуальной машине
   - Тестирует SSH подключение с сохраненными настройками
   - Возвращает статус подключения

5. **`/ls`** - Просмотр содержимого домашнего каталога
   - Выводит список всех файлов и папок в домашнем каталоге пользователя ВМ
   - Поддерживает разбивку на части для больших списков

6. **`/cat`** - Чтение содержимого текстовых файлов
   - Находит все текстовые файлы в домашнем каталоге
   - Поддерживаемые форматы: .txt, .log, .conf, .cfg, .ini, .md, .py, .sh, .json, .xml, .yml, .yaml
   - Выводит содержимое всех найденных файлов

## Установка и запуск

### Требования:
- Python 3.8+
- Доступ к виртуальной машине с SSH

### Установка зависимостей:
```bash
pip install -r requirements.txt
```

### Настройка:
1. Убедитесь, что токен бота установлен в `config.py`
2. Создайте папку `instance` для базы данных (если не существует)

### Запуск:
```bash
python main.py
```

## Использование

1. **Начальная настройка:**
   ```
   /start - регистрация
   /vmpath 192.168.1.100:ubuntu:mypassword - настройка ВМ
   ```

2. **Проверка подключения:**
   ```
   /check - тест подключения
   ```

3. **Работа с файлами:**
   ```
   /ls - список файлов
   /cat - содержимое текстовых файлов
   ```

## Технические детали

### База данных:
- SQLite с асинхронным SQLAlchemy
- Таблицы: `user_table`, `vm_connections`

### SSH подключения:
- Использует библиотеку `paramiko`
- Асинхронные операции через `asyncio`
- Автоматическое отключение после выполнения команд

### Безопасность:
- Пароли хранятся в базе данных (в продакшене рекомендуется шифрование)
- SSH ключи не используются (только логин/пароль)
- Таймаут подключения: 10 секунд

## Структура проекта

```
├── main.py              # Главный файл запуска
├── config.py            # Конфигурация
├── requirements.txt     # Зависимости
├── db/                  # База данных
│   ├── models.py        # Модели данных
│   ├── engine.py        # Настройка подключения
│   └── __init__.py
├── handlers/            # Обработчики команд
│   ├── handlers.py      # Основные обработчики
│   ├── bot_commands.py  # Команды бота
│   ├── callbacks.py     # Callback обработчики
│   ├── keyboard.py      # Клавиатуры
│   └── __init__.py
├── utils/               # Утилиты
│   ├── ssh_client.py    # SSH клиент
│   └── logging.py
└── tests/               # Тесты
```

## Примеры использования

### Настройка ВМ:
```
Пользователь: /vmpath 192.168.1.100:ubuntu:mypassword
Бот: Настройки ВМ сохранены:
     IP: 192.168.1.100
     Пользователь: ubuntu
     
     Используйте /check для проверки подключения
```

### Проверка подключения:
```
Пользователь: /check
Бот: Проверяю подключение к ВМ...
     ✅ Подключение к ВМ успешно установлено!
```

### Просмотр файлов:
```
Пользователь: /ls
Бот: Получаю список файлов...
     ```
     total 40
     drwxr-xr-x 2 ubuntu ubuntu 4096 Jan 15 10:30 .
     drwxr-xr-x 3 root   root   4096 Jan 15 10:30 ..
     -rw-r--r-- 1 ubuntu ubuntu  220 Jan 15 10:30 .bash_logout
     -rw-r--r-- 1 ubuntu ubuntu 3771 Jan 15 10:30 .bashrc
     -rw-r--r-- 1 ubuntu ubuntu  807 Jan 15 10:30 .profile
     -rw-r--r-- 1 ubuntu ubuntu   25 Jan 15 10:30 test.txt
     ```
```

## Примечания

- Бот поддерживает только подключения по паролю (SSH ключи не используются)
- Все операции выполняются асинхронно для лучшей производительности
- Большие файлы автоматически разбиваются на части для отправки в Telegram
- Рекомендуется использовать в тестовой среде перед развертыванием в продакшене